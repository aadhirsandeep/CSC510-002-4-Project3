# Quick Test Commands for Driver Assignment Feature
# =================================================

# IMPORTANT: Replace TOKEN values with actual tokens from login responses

# =============================================
# STEP 1: Setup (Create Accounts)
# =============================================

# Register Driver
curl -X POST "http://localhost:8000/drivers/register" \
  -H "Content-Type: application/json" \
  -d '{"email":"driver1@test.com","name":"John Driver","password":"driver123"}'

# Register User
curl -X POST "http://localhost:8000/users/register" \
  -H "Content-Type: application/json" \
  -d '{"email":"user@test.com","name":"Test User","password":"user123"}'

# Register Owner
curl -X POST "http://localhost:8000/users/register" \
  -H "Content-Type: application/json" \
  -d '{"email":"owner@test.com","name":"Owner","password":"owner123","role":"OWNER"}'


# =============================================
# STEP 2: Login and Get Tokens
# =============================================

# Login as Driver (save access_token)
curl -X POST "http://localhost:8000/drivers/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"driver1@test.com","password":"driver123"}'

# Login as User (save access_token)
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"user@test.com","password":"user123"}'

# Login as Owner (save access_token)
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"owner@test.com","password":"owner123"}'


# =============================================
# STEP 3: Create Cafe (as Owner)
# =============================================

curl -X POST "http://localhost:8000/cafes" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{"name":"Test Cafe","address":"123 Main St","lat":37.7749,"lng":-122.4194}'


# =============================================
# STEP 4: Post Driver Location (IDLE status)
# =============================================

curl -X POST "http://localhost:8000/drivers/1/location-status" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_DRIVER_TOKEN" \
  -d '{"lat":37.7750,"lng":-122.4195,"status":"IDLE}"'


# =============================================
# STEP 5: Check Available Drivers
# =============================================

curl -X GET "http://localhost:8000/drivers/available" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN"


# =============================================
# STEP 6: Place Order and Accept
# =============================================

# Create item first (as owner)
curl -X POST "http://localhost:8000/cafes/1/items" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{"name":"Burger","description":"Delicious burger","calories":500,"price":12.99,"veg_flag":false}'

# Add to cart (as user)
curl -X POST "http://localhost:8000/cart/add" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_USER_TOKEN" \
  -d '{"item_id":1,"quantity":2}'

# Place order (as user)
curl -X POST "http://localhost:8000/orders/place" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_USER_TOKEN" \
  -d '{"cafe_id":1}'

# Accept order (as owner)
curl -X POST "http://localhost:8000/orders/1/status" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '"ACCEPTED"'


# =============================================
# STEP 7: Assign Driver (AUTO - Nearest Driver)
# =============================================

curl -X POST "http://localhost:8000/orders/1/assign-driver" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{}'


# =============================================
# STEP 8: Verify Driver is OCCUPIED
# =============================================

# Check available drivers (should be empty)
curl -X GET "http://localhost:8000/drivers/available" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN"


# =============================================
# STEP 9: Get Driver's Assigned Orders
# =============================================

curl -X GET "http://localhost:8000/drivers/1/assigned-orders" \
  -H "Authorization: Bearer YOUR_DRIVER_TOKEN"


# =============================================
# STEP 10: Order Flow - Ready, Pickup, Deliver
# =============================================

# Mark order as ready
curl -X POST "http://localhost:8000/orders/1/status" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '"READY"'

# Driver picks up
curl -X POST "http://localhost:8000/drivers/1/orders/1/pickup" \
  -H "Authorization: Bearer YOUR_DRIVER_TOKEN"

# Driver delivers
curl -X POST "http://localhost:8000/drivers/1/orders/1/deliver" \
  -H "Authorization: Bearer YOUR_DRIVER_TOKEN"


# =============================================
# STEP 11: Verify Driver is Back to IDLE
# =============================================

curl -X GET "http://localhost:8000/drivers/available" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN"


# =============================================
# ALTERNATIVE: Manually Assign Specific Driver
# =============================================

curl -X POST "http://localhost:8000/orders/2/assign-driver" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{"driver_id":1}'


# =============================================
# ERROR CASE TESTS
# =============================================

# Try to assign driver to PENDING order (should fail)
curl -X POST "http://localhost:8000/orders/3/assign-driver" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{}'

# Try to assign already-assigned order (should fail)
curl -X POST "http://localhost:8000/orders/1/assign-driver" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{}'

# Try to assign OCCUPIED driver (should fail)
curl -X POST "http://localhost:8000/orders/2/assign-driver" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_OWNER_TOKEN" \
  -d '{"driver_id":1}'

